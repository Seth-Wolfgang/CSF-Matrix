/**
 * @file SparseMatrix
 * @author Skyler Ruiter and Seth Wolfgang
 * @brief IVSparse Sparse Matrix Library
 * @version 0.1
 * @date 2023-07-03
 */

// #pragma once
#ifndef _SEEN_IVSPARSE
#define _SEEN_IVSPARSE

 // Library Constants
#define DELIM 0
#define NUM_META_DATA 6
#define META_DATA_SIZE 24
#define ONE_BYTE_MAX 255
#define TWO_BYTE_MAX 65535
#define FOUR_BYTE_MAX 4294967295

// Parallel Processing Directives (On by default)
#if (defined _OPENMP) && (!defined IVSPARSE_DONT_PARALLEL)
#define IVSPARSE_HAS_OPENMP
#endif
#ifdef IVSPARSE_HAS_OPENMP

#include <atomic>
#include <omp.h>


#endif

// Debugging Directives (Off by default)
#ifndef IVSPARSE_DEBUG_OFF
#define IVSPARSE_DEBUG
#endif

#if defined(_WIN32) || defined(WIN32) || defined(__CYGWIN__) || defined(__MINGW32__) || defined(__BORLANDC__)
#define OS_WIN
#endif

#if defined(OS_WIN)

#define NOMINMAX
#include <windows.h>
#include <io.h>
#include <stdexcept>

#define ASYNCH_WRITE(fd, buf, len, offset) \
    DWORD bytesWritten; \
    OVERLAPPED overlapped = {0}; \
    overlapped.Offset = offset; \
    if (!WriteFile(fd, buf, len, &bytesWritten, &overlapped)) { \
        throw std::runtime_error(std::string("WriteFile error: ") + std::to_string(GetLastError())); \
    } \



#elif defined(__linux__) || defined(__APPLE__)

#include <unistd.h>

#define ASYNCH_WRITE(fd, buf, len, offset) \
    if ((pwrite(fileno(fd), buf, len, offset)) == -1) [[unlikely]] { \
        throw std::runtime_error(std::string("pwrite error: ") + strerror(errno)); \
    } \


#endif

#include <iostream>
#include <vector>
#include <map>
#include <algorithm>
#include <type_traits>
#include <iomanip>
#include <type_traits>
#include <unordered_map>
#include <mutex>

namespace IVSparse {

    const int RowMajor = 0;
    const int ColMajor = 1;

    template <typename T, bool columnMajor>
    class IVCSC;

    template <typename T, typename indexT, bool columnMajor>
    class VCSC;
}

// Library Includes
#define EIGEN_MATRIXBASE_PLUGIN "../../../../IVSparse/src/Eigen_Extension/Matrix_Extension.hpp"
#define EIGEN_SPARSEMATRIXBASE_PLUGIN "../../../../IVSparse/src/Eigen_Extension/Sparse_Matrix_Extension.hpp"

#include "../eigen/Eigen/Core"
#include "../eigen/Eigen/Sparse"

// Class Declarations
#include "src/VCSC/VCSC_SparseMatrix.hpp"
#include "src/IVCSC/IVCSC_SparseMatrix.hpp"


#ifdef IVSPARSE_HAS_OPENMP /*&& !defined(OS_WIN)*/

 // multithreaded versions of (some) algorithms
#include "src/IVCSC/Parallel/IVCSC_Parallel_Methods.hpp"
#include "src/IVCSC/Parallel/IVCSC_Parallel_Operators.hpp"
#include "src/IVCSC/Parallel/IVCSC_Parallel_BLAS.hpp"

#include "src/VCSC/Parallel/VCSC_Parallel_Methods.hpp"
#include "src/VCSC/Parallel/VCSC_Parallel_Operators.hpp"
#include "src/VCSC/Parallel/VCSC_Parallel_BLAS.hpp"

#endif

// IVCSC Files
#include "src/IVCSC/IVCSC_Private_Methods.hpp"
#include "src/IVCSC/IVCSC_Constructors.hpp"
#include "src/IVCSC/IVCSC_Methods.hpp"
#include "src/IVCSC/IVCSC_Operators.hpp"
#include "src/IVCSC/IVCSC_BLAS.hpp"

// IVCSC Iterator Files
#include "src/InnerIterators/IVCSC_Iterator.hpp"
#include "src/InnerIterators/IVCSC_Iterator_Methods.hpp"

// VCSC Files
#include "src/VCSC/VCSC_Private_Methods.hpp"
#include "src/VCSC/VCSC_Constructors.hpp"
#include "src/VCSC/VCSC_Methods.hpp"
#include "src/VCSC/VCSC_Operators.hpp"
#include "src/VCSC/VCSC_BLAS.hpp"

// VCSC Iterator Files
#include "src/InnerIterators/VCSC_Iterator.hpp"
#include "src/InnerIterators/VCSC_Iterator_Methods.hpp"
#endif